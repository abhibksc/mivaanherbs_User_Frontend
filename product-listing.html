<!-- File: product-listing.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mivaan Herbs - Products</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link rel="icon" href="img/favicon.ico" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <!-- Header -->
    <div class="container-fluid bg-white sticky-top">
      <div class="container">
        <nav class="navbar navbar-expand-lg bg-white navbar-light py-2 py-lg-0">
          <a href="index.html" class="navbar-brand">
            <img class="img-fluid" src="img/logo.png" alt="Logo" />
          </a>
          <div class="collapse navbar-collapse">
            <div class="navbar-nav ms-auto">
              <a href="index.html" class="nav-item nav-link">Home</a>
              <a href="product-listing.html" class="nav-item nav-link active"
                >Products</a
              >
              <a href="store.html" class="nav-item nav-link">Store</a>
              <a href="contact.html" class="nav-item nav-link">Contact</a>
            </div>
          </div>
        </nav>
      </div>
    </div>

    <!-- Page Header -->
    <div class="container-fluid page-header py-5 mb-5 text-center bg-light">
      <h1 class="display-4 text-dark">All Products</h1>
    </div>

    <!-- Product Grid -->
    <div class="container py-5">
      <div class="row g-4">
        <!-- Product Card 1 -->
        <div class="col-lg-3 col-md-6">
          <div class="card border-0 shadow-sm">
            <img src="img/store-product-1.jpg" class="card-img-top" alt="..." />
            <div class="card-body text-center">
              <h5 class="card-title">Nature Close Aloevera</h5>
              <p class="card-text">$19.00</p>
              <a
                href="product-detail.html?id=1"
                class="btn btn-sm btn-outline-primary"
                >View Detail</a
              >
              <button
                class="btn btn-sm btn-dark mt-2 buy-btn"
                data-id="1"
                data-name="Nature Close Aloevera"
                data-price="19.00"
                data-img="img/store-product-1.jpg"
              >
                Buy
              </button>
            </div>
          </div>
        </div>

        <!-- Product Card 2 -->
        <div class="col-lg-3 col-md-6">
          <div class="card border-0 shadow-sm">
            <img src="img/store-product-2.jpg" class="card-img-top" alt="..." />
            <div class="card-body text-center">
              <h5 class="card-title">Green Aloevera Tulsi</h5>
              <p class="card-text">$19.00</p>
              <a
                href="product-detail.html?id=2"
                class="btn btn-sm btn-outline-primary"
                >View Detail</a
              >
              <button
                class="btn btn-sm btn-dark mt-2 buy-btn"
                data-id="2"
                data-name="Green Aloevera Tulsi"
                data-price="19.00"
                data-img="img/store-product-2.jpg"
              >
                Buy
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Buy Confirmation Modal -->
    <div
      class="modal fade"
      id="buyModal"
      tabindex="-1"
      aria-labelledby="buyModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Confirm Purchase</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="modalProductInfo">
            Are you sure you want to buy this product?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-success" id="confirmBuyBtn">
              Confirm Buy
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
      <div class="container text-center">
        &copy; 2025 Mivaan Herbs Pvt Ltd. Designed by
        <a href="https://itgenixs.com/" class="text-primary">IT GENIXS</a>.
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let selectedProduct = null;


        document.querySelectorAll(".buy-btn").forEach((button) => {
  button.addEventListener("click", function () {


    const token = localStorage.getItem("token");

    if (!token) {
      // Redirect to signup if not logged in
      window.location.href = "signup.html";
      return;
    }

    

    selectedProduct = {
      id: this.dataset.id,
      name: this.dataset.name,
      price: this.dataset.price,
      img: this.dataset.img,
    };

    document.getElementById(
      "modalProductInfo"
    ).innerText = `Are you sure you want to buy "${selectedProduct.name}" for $${selectedProduct.price}?`;

    const modal = new bootstrap.Modal(
      document.getElementById("buyModal")
    );
    modal.show();
  });
});




       

        document
          .getElementById("confirmBuyBtn")
          .addEventListener("click", function () {
            if (selectedProduct) {
              purchaseItem(selectedProduct);
              const modal = bootstrap.Modal.getInstance(
                document.getElementById("buyModal")
              );
              modal.hide();
            }
          });

        function purchaseItem(product) {


             const tokens = localStorage.getItem("token");

        if(!tokens){
    window.location.href = "signup.html";
    return
        }



          // üî• Replace with your real API base URL
          const apiUrl = "https://mivaanherbs.onrender.com/api/user/activate";
          const token = localStorage.getItem("token"); // Or any key you're using to store login state
          const userName = localStorage.getItem("userName"); // Or any key you're using to store login state

          //  username, packageAmount

          fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`, // Replace with actual token
            },
            body: JSON.stringify({
              username: userName,
              packageAmount: product.price,
            }),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
              alert(
                `‚úÖ Activated: ${product.name} (${data.message || "Success"})`
              );
              console.log("Server Response:", data);
            })
            .catch((error) => {
              console.error("Activation failed:", error);
              alert("‚ùå Purchase failed. Please try again.");
            });
        }
      });
    </script>
  </body>
</html>
